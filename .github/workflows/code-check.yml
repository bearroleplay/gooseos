name: Code Quality Check

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  check:
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• Checkout code
      uses: actions/checkout@v3
    
    - name: ‚öôÔ∏è Setup clang-format
      run: sudo apt-get update && sudo apt-get install -y clang-format
    
    - name: üîß Make scripts executable
      run: chmod +x scripts/*.sh
    
    - name: üìù Check formatting
      run: |
        echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."
        if find . -name "*.c" -o -name "*.h" | xargs clang-format --dry-run --Werror; then
          echo "‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
        else
          echo "‚ùå –û—à–∏–±–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
          echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ: make format"
          exit 1
        fi
    
    - name: üí¨ Check comments
      run: |
        echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤..."
        ./scripts/check_comments.sh
    
    - name: üì§ Upload report
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: code-quality-report
        path: |
          **/*.c
          **/*.h
        retention-days: 1
